<!doctype html><html lang=ja><head><title>Rubyã®WebAssemblyã‚’è©¦ã—ã¦ã¿ãŸ - mitsubosh's blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel=stylesheet><link rel=stylesheet href=https://mitsuboshi.github.io/blog/css/bootstrap.css><link rel=stylesheet href=https://mitsuboshi.github.io/blog/css/custom.css></head><body><main id=main><div class=container><div class="row justify-content-center text-center my-5"><div class=col-lg-10><a href=https://mitsuboshi.github.io/blog/categories/ja/ class="d-inline-block link-cta mb-4 text-uppercase">ja</a><h1 class="mb-4 text-center">Rubyã®WebAssemblyã‚’è©¦ã—ã¦ã¿ãŸ</h1><p class="small mb-5 text-center"><span class=text-uppercase>January 10, 2023</span></p></div></div></div><div class="bg-skew bg-skew-light"><div class=container><div class="row justify-content-center"><div class=col-lg-8><article class=pb-2><p>å¹´å§‹ã«è‚²å…ã®åˆé–“ã‚’ç¸«ã£ã¦Ruby3.2ã§å°‘ã—ã ã‘éŠã‚“ã§ã¿ã¾ã—ãŸã€‚<br>ä¸Šã®å­ãŒçµµæœ¬ã€<a href=https://www.amazon.co.jp/dp/4774604097>åäºŒæ”¯ã®ã¯ã˜ã¾ã‚Š</a>ã€ã‚’æœ€è¿‘èª­ã‚“ã§ã€å¹²æ”¯ã‚’èªè­˜ã—å§‹ã‚ã¦æ¥ãŸã®ã§ã€ãã‚Œã«é–¢é€£ã—ãŸã‚‚ã®ã‚’ç°¡æ˜“çš„ã«ä½œã‚Šã¾ã—ãŸã€‚</p><p><a href=https://mitsuboshi.github.io/eto/>https://mitsuboshi.github.io/eto/</a></p><p>â€»iOS/Androidç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ä¸Šæ‰‹ãå‹•ä½œã—ãªã„ã§ã™</p><h2 id=gem-etoji>gem &ldquo;etoji&rdquo;</h2><p><a href=https://github.com/MITSUBOSHI/etoji>https://github.com/MITSUBOSHI/etoji</a></p><p>ä»¥ä¸‹ã®ã‚ˆã†ã«è¥¿æš¦ã‹ã‚‰å¯¾è±¡ã¨ãªã‚‹å¹²æ”¯(åäºŒæ”¯)ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªgemã§ã™ã€‚<br>(<code>geto</code> ã¯get + å¹²æ”¯ã®é€ èª)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>require <span style=color:#e6db74>&#39;etoji&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Etoji</span><span style=color:#f92672>.</span>geto(<span style=color:#e6db74>year</span>: <span style=color:#ae81ff>2023</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># =&gt; #&lt;data Etoji::Jyunishi::Animal</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  number=4,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  emoji=&#34;ğŸ°&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  character=&#34;å¯&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  character_hiragana_kun=&#34;ã†&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  character_hiragana_on=&#34;ã¼ã†&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  animal_name_ja=&#34;å…&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  animal_name_ja_hiragana=&#34;ã†ã•ã&#34;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  animal_name_en=&#34;rabbit&#34;&gt;</span>
</span></span></code></pre></div><p>ãƒ¢ãƒ€ãƒ³ãªRubyã‚’æ›¸ã„ã¦ã¿ãŸãã€<code>Data</code> ã‚¯ãƒ©ã‚¹ ã‚„ ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã‚’ä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚<br>ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã¯ãšã£ã¨ä½¿ã„ãŸã„ã¨æ€ã£ã¦ã„ãŸã‚“ã§ã™ãŒã€ä¸­ã€…ä½¿ã†æ©Ÿä¼šãŒç„¡ã‹ã£ãŸã®ã€ç„¡ç†ã‚„ã‚Šä½¿ã„ã¾ã—ãŸ(ãŒã€ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã¯case-whenã§ååˆ†ãªã“ã¨ã«å¾Œã§æ°—ã¥ã„ãŸ)ã€‚</p><p>Steep(RBS)ã§å‹ãƒã‚§ãƒƒã‚¯ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚<br><code>Data</code> ã‚¯ãƒ©ã‚¹ã®rbsãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¬å¼ã«ã¾ã å­˜åœ¨ã—ãªã‹ã£ãŸã‚Šã€case-inã®è¨˜æ³•ã‚’ä½¿ã†ã¨ã€Syntax <code>case_match</code> is not supported in Steepã€ã¨ <code>Ruby::UnsupportedSyntax</code> ã«ãªã£ãŸã‚Šã¨ã‚„ã‚„å›°ã‚Šã¾ã—ãŸã€‚<br>typeprofã§rbsãƒ•ã‚¡ã‚¤ãƒ«ã®é››å½¢ç”Ÿæˆã‚’ã—ã¦ã€untypedãªå‹å®šç¾©ã‚’ä¿®æ­£ã—ã¦ã„ãä½“é¨“ã¯è‰¯ã‹ã£ãŸã§ã™ã€‚</p><p>sorbet(RBI)ã®<a href=https://github.com/Shopify/tapioca>Shopify/tapioca</a>ã®ã‚ˆã†ã«Rails applicationå‘ã‘ã«è‰¯ã„æ„Ÿã˜ãªrbsãƒ•ã‚¡ã‚¤ãƒ«ã‚’åãå‡ºã›ãŸã‚Šã€
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã«æ²¿ã£ã¦å‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åãå‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã‚ˆã‚Šå¬‰ã—ã„ã§ã™ã€‚</p><h3 id=refs>Refs</h3><ul><li><a href=https://github.com/tbpgr/eto>https://github.com/tbpgr/eto</a><ul><li>æ—¢ã«ä¼¼ãŸgemãŒå­˜åœ¨ã—ã¦ã„ãŸã®ã§ã€å‚è€ƒã«ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸ</li></ul></li><li><a href=https://github.com/github/gemoji>https://github.com/github/gemoji</a><ul><li>å¹²æ”¯(åå¹²ãƒ»åäºŒæ”¯)ã®ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ã®ä»•æ–¹ã¯ã€ã“ã®gemã® <code>db/emoji.json</code> å‚è€ƒã«ã—ã¾ã—ãŸ</li></ul></li><li><a href=https://ja.wikipedia.org/wiki/%E5%B9%B2%E6%94%AF>https://ja.wikipedia.org/wiki/å¹²æ”¯</a></li></ul><h2 id=webassembly>WebAssembly</h2><p><a href=https://github.com/MITSUBOSHI/eto>https://github.com/MITSUBOSHI/eto</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ curl -L https://github.com/ruby/ruby.wasm/releases/latest/download/ruby-head-wasm32-unknown-wasi-full-js.tar.gz | tar xfvz -
</span></span><span style=display:flex><span>$ mv head-wasm32-unknown-wasi-full-js/usr/local/bin/ruby ruby.wasm
</span></span><span style=display:flex><span>$ wasi-vfs pack ruby.wasm --mapdir /usr::./head-wasm32-unknown-wasi-full-js/usr --mapdir /etoji::./etoji -o docs/etoji.wasm
</span></span></code></pre></div><p>ã§etoji libraryã‚’æ¢±åŒ…ã—ã¦WASMã‚’è©¦ã™ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚<br>(æœ¬å½“ã¯bundlerçµŒç”±ã§gem &ldquo;etoji"ã‚’åˆ©ç”¨ã—ãŸã‹ã£ãŸãŒã€æ‰‹ã‚’æŠœãã¾ã—ãŸã€‚å¾Œã§è©¦ãã†ã¨æ€ã„ã¾ã™ã€‚)<br>æœ€åˆå…¬å¼repoã®READMEç­‰ã‚’èª­ã¾ãšã«ä½•ã‚‚è€ƒãˆãš <code>ruby-head-wasm32-unknown-wasi-full</code> ã‚’åˆ©ç”¨ã—ã¦ã„ãŸãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§å¿…è¦ãª <code>rb-js-abi-host</code> ãŒå­˜åœ¨ã›ãšå‹•ã‹ãªã„ãªã©ãŠç²—æœ«ãªã“ã¨ã‚’ã—ã¾ã—ãŸã€‚<br>(<a href=https://github.com/ruby/ruby.wasm/tree/main/ext>https://github.com/ruby/ruby.wasm/tree/main/ext</a> ãŒå¿…é ˆ)</p><p>ã€Œè¦‹ãŸç›®ã¯å¾Œã§æ•´ãˆã‚Œã°ã„ã„ã ã‚ã†ã€ã€Œä¸€æ—¦ã€å­ã©ã‚‚ã«è¦‹ã›ã‚‹ã‹ã€ã¨æ€ã£ã¦ã€iPhoneã§å‹•ä½œã—ãªã„ã“ã¨ã«æ°—ã¥ãæ‚²ã—ããªã‚Šã¾ã—ãŸã€‚<br>macOSä¸Šã®Chrome/Safariã§ã¯å•é¡Œãªãå‹•ä½œã¯ã—ã¦ã„ã¦ã€iOS * WebAssemblyã§é›‘ã«èª¿ã¹ã‚‹ã¨ãƒ¡ãƒ¢ãƒªé–¢é€£ã§è‹¦ã—ã‚“ã§ã„ã‚‹è¨˜äº‹ã‚’ã„ãã¤ã‹ç›®ã«ã—ãŸã¨ã“ã‚ã§æ™‚é–“åˆ‡ã‚Œã«ãªã£ãŸã®ã§ã€æ·±è¿½ã„ã—ã¦ã„ã¾ã›ã‚“ã€‚</p><p>ã„ã¤ã‹ä»•äº‹ã§ã‚‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å…±é€šãƒ­ã‚¸ãƒƒã‚¯(åŒä¸€ã‚½ãƒ¼ã‚¹)ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã•ã›ã‚‹ãªã©ã®ç”¨é€”ã§WebAssemblyã‚’ä½¿ã†ãªã©ã—ã¦ã¿ãŸã„æ°—æŒã¡ã§ã™ã€‚</p><h3 id=refs-1>Refs</h3><ul><li><a href=https://zenn.dev/koduki/articles/3619f53e8c0575>https://zenn.dev/koduki/articles/3619f53e8c0575</a></li><li><a href=https://github.com/kateinoigakukun/wasi-vfs/wiki/Getting-Started-with-CRuby>https://github.com/kateinoigakukun/wasi-vfs/wiki/Getting-Started-with-CRuby</a></li><li><a href=https://github.com/ruby-syntax-tree/ruby-syntax-tree.github.io>https://github.com/ruby-syntax-tree/ruby-syntax-tree.github.io</a></li></ul><p class="mt-5 text-center"><span class=text-secondary>Tagged: </span><a href=https://mitsuboshi.github.io/blog/tags/ruby/ class="link-tag text-dark">#ruby</a>
<a href=https://mitsuboshi.github.io/blog/tags/wasm/ class="link-tag text-dark">#wasm</a>
<a href=https://mitsuboshi.github.io/blog/tags/tech/ class="link-tag text-dark">#tech</a></p></article><div class="row pt-5 pb-5"><div class="col-6 text-left"><a class=text-reset href=https://mitsuboshi.github.io/blog/memory/looking-back-2022/>&larr; 2022å¹´ã®æŒ¯ã‚Šè¿”ã‚Š</a></div><div class="col-6 text-right"></div></div></div></div></div></div></main><footer class="site-footer mt-5"><div class=container><div class="row justify-content-md-between"><div class="col-sm-12 col-md-4 mb-4"><h2 class="h5 mb-3">mitsubosh's blog</h2><p></p></div><div class="col-4 col-md-2 mb-4"><h2 class="h5 mb-3">Menu</h2><ul class="nav flex-column"><li class=mb-1><a href=https://mitsuboshi.github.io/blog/ class=text-secondary>Home</a></li></ul></div></div><hr><div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-center"><div class="text-muted mb-3">Â© 2020 MITSUBOSHI Yuya
<a href=https://10mohi6.tk class=text-reset>design</a> <a href=https://github.com/10mohi6/hugo-theme-simple-blog class=text-reset>theme</a></p></div></div></div></footer></body></html>